{{- $timestamp := generate "timestamp" }}
{{- $agent_id := generate "agent_id" }}
{{- $agent_name := generate "agent_name" }}
{{- $agent_ephemeral_id := generate "agent_ephemeral_id" }}
{{- $event_duration := generate "event_duration" }}
{{- $rangeofid := generate "rangeofid" -}}
{{- $nodeid := div $rangeofid 110 -}}
{{- $container_name := generate "container_name" }}
{{- $status_phase := generate "status_phase" }}
{{- $status_ready := generate "status_ready" }}
{{- $restarts := generate "restarts" }}
{{- $reason := generate "reason" }}
{{- $cpu_limit_cores := generate "cpu_limit_cores" }}
{{- $cpu_request_cores := generate "cpu_request_cores" }}
{{- $memory_limit_bytes := generate "memory_limit_bytes" }}
{{- $memory_request_bytes := generate "memory_request_bytes" }}
{
    "@timestamp": "{{$timestamp.Format "2006-01-02T15:04:05.999999Z07:00"}}",
    "container": {
        "image": {
            "name": "k8s.gcr.io/coredns/coredns:v1.8.0"
        },
        "name": "{{ $container_name }}",
        "runtime": "containerd",
        "id": "container-{{ $rangeofid }}"
    },
    "kubernetes": {
        "container": {
            "memory": {
                "request": {
                    "bytes": {{ $memory_request_bytes }}
                },
                "limit": {
                    "bytes": {{ $memory_limit_bytes }}
                }
            },
            "name": "coredns",
            "cpu": {
                "request": {
                    "cores": {{ $cpu_request_cores }}
                },
                "limit": {
                    "cores": {{ $cpu_limit_cores }}
                }
            },
            "id": "container-{{ $rangeofid }}",
            "status": {
                "phase": "{{ $status_phase }}",
                "ready": {{ $status_ready }},
                "restarts": {{ $restarts }},
                "reason": "{{ $reason }}"
            }
        },
        "node": {
            "uid": "host-{{ $nodeid }}",
            "hostname": "host-{{ $nodeid }}",
            "name": "host-{{ $nodeid }}",
            "labels": {
                "kubernetes_io/hostname": "kind-control-plane",
                "beta_kubernetes_io/os": "linux",
                "kubernetes_io/arch": "amd64",
                "kubernetes_io/os": "linux",
                "beta_kubernetes_io/arch": "amd64"
            }
        },
        "pod": {
            "uid": "demo-pod-{{ $rangeofid }}",
            "ip": "{{generate `Ip`}}",
            "name": "demo-pod-{{ $rangeofid }}"
        },
        "namespace": "demo-{{ $rangeofid }}",
        "namespace_uid": "demo-{{ $rangeofid }}",
        "replicaset": {
            "name": "demo-deployment-{{ $rangeofid }}"
        },
        "namespace_labels": {
            "kubernetes_io/metadata_name": "demo-{{ $rangeofid }}"
        },
        "labels": {
            "app":"demo",
            "pod-template-hash":"{{ $rangeofid }}",
            "app-2":"demo-2",
            "app-1":"demo-1"
        },
        "deployment": {
            "name": "demo-deployment-{{ $rangeofid }}"
        }
    },
    "agent": {
        "name": "{{ $agent_name }}",
        "id": "{{ $agent_id }}",
        "ephemeral_id": "{{ $agent_ephemeral_id }}",
        "type": "metricbeat",
        "version": "8.8.0"
    },
    "elastic_agent": {
        "id": "{{ $agent_id }}",
        "version": "8.8.0",
        "snapshot": true
    },
    "cloud": {
         "provider": "gcp",
         "availability_zone": "europe-west1-d",
         "instance":{
         "name":  "{{ $agent_name }}" ,
         "id": "{{ $agent_id }}"
         },
         "machine":{
            "type":"e2-standard-4"
         },
         "service":{
            "name":"GCE"
         },
         "project":{
            "id":"elastic-obs-integrations-dev"
         },
         "account":{
            "id":"elastic-obs-integrations-dev"
         }
      },
      "orchestrator":{
         "cluster":{
            "name":"kubernetes-scale",
            "url":"https://{{ generate `Ip` }}"
         }
      },
    "ecs": {
        "version": "8.0.0"
    },
    "data_stream": {
        "namespace": "ep",
        "type": "metrics",
        "dataset": "kubernetes.state_container"
    },
    "service": {
        "address": "http://{{ $agent_name }}:8080/metrics",
        "type": "kubernetes"
    },
    "host": {
        "hostname": "kind-control-plane",
        "os": {
            "kernel": "5.10.47-linuxkit",
            "codename": "Core",
            "name": "CentOS Linux",
            "type": "linux",
            "family": "redhat",
            "version": "7 (Core)",
            "platform": "centos"
        },
        "containerized": true,
        "ip": [
            "192.168.244.7"
        ],
        "name": "kind-control-plane",
        "id": "85e35c2b5e1b39ba72393a6baf6ee7cd",
        "mac": [
            "fe:ec:82:9f:29:19"
        ],
        "architecture": "x86_64"
    },
    "metricset": {
        "period": 10000,
        "name": "state_container"
    },
    "event": {
        "duration": {{ $event_duration }},
        "agent_id_status": "verified",
        "module": "kubernetes",
        "dataset": "kubernetes.state_container"
    }
}